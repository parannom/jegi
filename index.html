<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì œê¸°ì°¨ê¸° ê²Œì„</title>
    <style>
        body {
            text-align: center;
        }
        #gameContainer {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin: 0 auto;
        }
        #gameCanvas {
            background-color: #f0f0f0;
            border: 1px solid #000;
        }
        #colorSelector {
            margin-left: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .color-button {
            margin-bottom: 10px;
            width: 50px;
            height: 50px;
            border: none;
            cursor: pointer;
            outline: none;
            position: relative;
        }
        .color-button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        .color-button.selected {
            border: 3px solid black;
        }
        .lock-icon {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 20px;
            height: 20px;
        }
        .color-info {
            font-size: 12px;
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>ì œê¸°ì°¨ê¸° ê²Œì„</h1>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        <div id="colorSelector">
            <!-- ìƒ‰ìƒ ì„ íƒ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ê²Œì„ ì†ë„ ì¡°ì ˆì„ ìœ„í•œ ì‹œê°„ ê°„ê²©
        let lastTime = 0;
        const gameSpeed = 1000 / 60; // 60FPS

        // í”Œë ˆì´ì–´ ì„¤ì • (í¬ê¸° ê°ì†Œ)
        const player = {
            x: canvas.width / 2 - 12.5, // 25í”½ì…€ ìºë¦­í„°
            y: canvas.height - 50,
            width: 25,
            height: 50,
            speed: 3, // ì†ë„ ê°ì†Œ
            movingLeft: false,
            movingRight: false,
            chestGlow: 0 // ê°€ìŠ´ ë¹›ë‚˜ê¸° íš¨ê³¼ë¥¼ ìœ„í•œ ë³€ìˆ˜
        };

        // ì œê¸° ì„¤ì •
        let jegi = {
            width: 10,
            height: 10,
            x: canvas.width / 2 - 5, // ìº”ë²„ìŠ¤ ì¤‘ì•™ì— ìœ„ì¹˜
            y: canvas.height - 10,    // ë°”ë‹¥ì— ìœ„ì¹˜
            vx: 0,
            vy: 0,
            gravity: 0.3, // ì¤‘ë ¥ì€ ìƒ‰ìƒì— ë”°ë¼ ë³€ê²½ë¨
            inAir: false,
            glow: 0 // ì œê¸° ë°˜ì§ì„ íš¨ê³¼ë¥¼ ìœ„í•œ ë³€ìˆ˜
        };

        let score = 0;
        let highScore = parseInt(localStorage.getItem('highScore')) || 0; // ìµœê³  ì ìˆ˜ ë¡œë“œ
        let canKick = true;
        let isGameOver = false; // ê²Œì„ ì˜¤ë²„ ìƒíƒœë¥¼ ìœ„í•œ ë³€ìˆ˜

        // ìŠ¤í˜ì´ìŠ¤ë°” ë° ë§ˆìš°ìŠ¤ í´ë¦­ ìƒíƒœ ë³€ìˆ˜ ì¶”ê°€
        let spacebarPressed = false;
        let mouseClicked = false;

        // ì œê¸° ìƒ‰ìƒ ë° í•´ê¸ˆ ì¡°ê±´ ì„¤ì •
        const colors = [
            { name: 'ë¹¨ê°•', color: 'red', unlockScore: 0, extraScore: 0, gravity: 0.3 },
            { name: 'ì£¼í™©', color: 'orange', unlockScore: 10, extraScore: 1, gravity: 0.32 },
            { name: 'ë…¸ë‘', color: 'yellow', unlockScore: 20, extraScore: 2, gravity: 0.34 },
            { name: 'ì´ˆë¡', color: 'green', unlockScore: 30, extraScore: 3, gravity: 0.36 },
            { name: 'íŒŒë‘', color: 'blue', unlockScore: 40, extraScore: 4, gravity: 0.38 },
            { name: 'ë‚¨ìƒ‰', color: 'indigo', unlockScore: 50, extraScore: 5, gravity: 0.4 },
            { name: 'ë³´ë¼', color: 'violet', unlockScore: 100, extraScore: 6, gravity: 0.42 },
        ];

        // í•´ê¸ˆëœ ìƒ‰ìƒê³¼ ì„ íƒëœ ìƒ‰ìƒ ë¡œë“œ
        let unlockedColors = JSON.parse(localStorage.getItem('unlockedColors')) || ['red'];
        let selectedColor = localStorage.getItem('selectedColor') || 'red';

        // ìƒ‰ìƒ ë²„íŠ¼ ìƒì„± í•¨ìˆ˜
        function generateColorButtons() {
            const colorSelector = document.getElementById('colorSelector');
            colorSelector.innerHTML = ''; // ì´ì „ ë²„íŠ¼ ì œê±°

            colors.forEach(colorItem => {
                const buttonContainer = document.createElement('div');
                buttonContainer.style.display = 'flex';
                buttonContainer.style.flexDirection = 'column';
                buttonContainer.style.alignItems = 'center';

                const button = document.createElement('button');
                button.className = 'color-button';
                button.style.backgroundColor = colorItem.color;
                button.title = colorItem.name;
                buttonContainer.appendChild(button);

                const infoText = document.createElement('div');
                infoText.className = 'color-info';

                if (unlockedColors.includes(colorItem.color)) {
                    // í•´ê¸ˆëœ ìƒ‰ìƒ
                    infoText.textContent = `${colorItem.name} (í•´ê¸ˆë¨)\n+${colorItem.extraScore}ì , ì¤‘ë ¥ +${((colorItem.gravity - 0.3) * 100).toFixed(1)}%`;
                    button.disabled = false;
                    button.addEventListener('click', () => {
                        selectedColor = colorItem.color;
                        localStorage.setItem('selectedColor', selectedColor);
                        updateColorButtonStyles();
                        // ì„ íƒëœ ìƒ‰ìƒì˜ ì¤‘ë ¥ìœ¼ë¡œ ì„¤ì •
                        jegi.gravity = colorItem.gravity;
                    });
                } else {
                    // ì ê¸´ ìƒ‰ìƒ
                    infoText.textContent = `${colorItem.name} (ìµœê³  ì ìˆ˜ ${colorItem.unlockScore}ì  í•„ìš”)`;
                    button.disabled = true;
                    button.title += ` (ìµœê³  ì ìˆ˜ ${colorItem.unlockScore}ì  í•„ìš”)`;

                    // ì ê¸ˆ ì•„ì´ì½˜ ì¶”ê°€
                    const lockIcon = document.createElement('span');
                    lockIcon.className = 'lock-icon';
                    lockIcon.textContent = 'ğŸ”’';
                    button.appendChild(lockIcon);
                }

                buttonContainer.appendChild(infoText);
                colorSelector.appendChild(buttonContainer);
            });

            updateColorButtonStyles();
        }

        // ì„ íƒëœ ìƒ‰ìƒì„ í‘œì‹œí•˜ê¸° ìœ„í•œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
        function updateColorButtonStyles() {
            const buttons = document.querySelectorAll('.color-button');
            buttons.forEach(button => {
                if (button.style.backgroundColor === selectedColor) {
                    button.classList.add('selected');
                } else {
                    button.classList.remove('selected');
                }
            });
        }

        // ìƒ‰ìƒ í•´ê¸ˆ í™•ì¸ í•¨ìˆ˜
        function checkForUnlockedColors() {
            colors.forEach(colorItem => {
                if (highScore >= colorItem.unlockScore && !unlockedColors.includes(colorItem.color)) {
                    unlockedColors.push(colorItem.color);
                    localStorage.setItem('unlockedColors', JSON.stringify(unlockedColors));
                    generateColorButtons(); // ë²„íŠ¼ ê°±ì‹ 
                }
            });
        }

        // ì´ˆê¸°í™” ì‹œ ìƒ‰ìƒ í•´ê¸ˆ í™•ì¸ ë° ë²„íŠ¼ ìƒì„±
        checkForUnlockedColors();
        generateColorButtons();

        // ì„ íƒëœ ìƒ‰ìƒì˜ ì¤‘ë ¥ìœ¼ë¡œ ì„¤ì •
        jegi.gravity = colors.find(color => color.color === selectedColor).gravity;

        // ì†Œë¦¬ ìƒì„± í•¨ìˆ˜ (8ë¹„íŠ¸ í†¤)
        function playSound(frequency, duration) {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.type = 'square'; // 8ë¹„íŠ¸ ëŠë‚Œì„ ìœ„í•œ ì‚¬ê°íŒŒ
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.start();

            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration / 1000);

            oscillator.stop(audioCtx.currentTime + duration / 1000);
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.addEventListener('keydown', (e) => {
            if (isGameOver) return; // ê²Œì„ ì˜¤ë²„ ìƒíƒœì—ì„œëŠ” ì…ë ¥ì„ ë°›ì§€ ì•ŠìŒ
            if (e.key === 'ArrowLeft') player.movingLeft = true;
            if (e.key === 'ArrowRight') player.movingRight = true;
            if (e.key === ' ' && !spacebarPressed) {
                spacebarPressed = true;
                if (!jegi.inAir) kickJegi();
                else attemptKick();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') player.movingLeft = false;
            if (e.key === 'ArrowRight') player.movingRight = false;
            if (e.key === ' ') {
                spacebarPressed = false;
            }
        });

        // ë§ˆìš°ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        canvas.addEventListener('mousedown', () => {
            if (isGameOver) return; // ê²Œì„ ì˜¤ë²„ ìƒíƒœì—ì„œëŠ” ì…ë ¥ì„ ë°›ì§€ ì•ŠìŒ
            if (!mouseClicked) {
                mouseClicked = true;
                if (!jegi.inAir) kickJegi();
                else attemptKick();
            }
        });

        canvas.addEventListener('mouseup', () => {
            mouseClicked = false;
        });

        // í„°ì¹˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ëª¨ë°”ì¼ ì§€ì›)
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€
            if (isGameOver) return;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const touchX = touch.clientX - rect.left;
            player.x = touchX - player.width / 2;

            if (!jegi.inAir) kickJegi();
            else attemptKick();
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault(); // í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€
            if (isGameOver) return;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const touchX = touch.clientX - rect.left;
            player.x = touchX - player.width / 2;

            // í”Œë ˆì´ì–´ê°€ ìº”ë²„ìŠ¤ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì œí•œ
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
        });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
        });

        // ë§ˆìš°ìŠ¤ ì´ë™ ì´ë²¤íŠ¸ ì²˜ë¦¬
        canvas.addEventListener('mousemove', (e) => {
            if (isGameOver) return; // ê²Œì„ ì˜¤ë²„ ìƒíƒœì—ì„œëŠ” ì…ë ¥ì„ ë°›ì§€ ì•ŠìŒ
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            player.x = mouseX - player.width / 2;

            // í”Œë ˆì´ì–´ê°€ ìº”ë²„ìŠ¤ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì œí•œ
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
        });

        // ì œê¸° ì°¨ê¸° í•¨ìˆ˜
        function kickJegi() {
            if (canKick) {
                // í”Œë ˆì´ì–´ì™€ ì œê¸°ì˜ ê±°ë¦¬ ê³„ì‚°
                let distanceX = Math.abs((player.x + player.width / 2) - (jegi.x + jegi.width / 2));
                // ì²˜ìŒì—ëŠ” í”Œë ˆì´ì–´ê°€ ì¤‘ì•™ ê·¼ì²˜ì— ìˆì–´ì•¼ë§Œ ì°° ìˆ˜ ìˆìŒ
                if (distanceX <= 25 && Math.abs(player.x + player.width / 2 - canvas.width / 2) <= 50) {
                    jegi.vy = -10; // ì†ë„ ê°ì†Œë¡œ ëŠë ¤ì§
                    jegi.vx = (Math.random() - 0.5) * 2; // ì¢Œìš°ë¡œ ì•½ê°„ í”ë“¤ë¦¼ ì¶”ê°€
                    jegi.inAir = true;
                    canKick = false;
                    jegi.glow = 5; // ì œê¸° ë°˜ì§ì„ íš¨ê³¼
                    playSound(800, 100); // ì œê¸° ì°° ë•Œ ì†Œë¦¬
                }
            }
        }

        // ê³µì¤‘ì—ì„œ ì œê¸° ë‹¤ì‹œ ì°¨ê¸°
        function attemptKick() {
            if (isGameOver) return; // ê²Œì„ ì˜¤ë²„ ìƒíƒœì—ì„œëŠ” ì…ë ¥ì„ ë°›ì§€ ì•ŠìŒ
            const jegiBottom = jegi.y + jegi.height;
            const playerChestTop = player.y + player.height / 4; // ê°€ìŠ´ ì‹œì‘ ìœ„ì¹˜
            const playerChestBottom = player.y + (player.height / 4) * 2; // ê°€ìŠ´ ë ìœ„ì¹˜ (ê°€ìŠ´ ì˜ì—­ ë‘ ë°°ë¡œ í™•ì¥)
            const playerHead = player.y; // ë¨¸ë¦¬ ìœ„ì¹˜
            const timingChest = jegiBottom - playerChestTop;
            const timingHead = jegiBottom - playerHead;
            const horizontalDistance = (jegi.x + jegi.width / 2) - (player.x + player.width / 2);

            if (Math.abs(horizontalDistance) <= 20) {
                if (timingChest >= -5 && timingChest <= (playerChestBottom - playerChestTop + 5)) {
                    // ê°€ìŠ´ì— ë§ìŒ
                    jegi.vy = -10; // ì†ë„ ê°ì†Œë¡œ ëŠë ¤ì§
                    jegi.vx += (Math.random() - 0.5) * 2; // ì¢Œìš°ë¡œ ì•½ê°„ í”ë“¤ë¦¼ ì¶”ê°€
                    jegi.glow = 5; // ì œê¸° ë°˜ì§ì„ íš¨ê³¼
                    player.chestGlow = 5; // ê°€ìŠ´ ë¹›ë‚˜ê¸° íš¨ê³¼
                    playSound(800, 100); // ì†Œë¦¬ ì¬ìƒ

                    // ì„ íƒëœ ìƒ‰ìƒì— ë”°ë¥¸ ì¶”ê°€ ì ìˆ˜
                    const colorItem = colors.find(color => color.color === selectedColor);
                    score += 2 + colorItem.extraScore; // ê¸°ë³¸ 2ì  + ì¶”ê°€ ì ìˆ˜
                } else if (timingHead >= -5 && timingHead <= 5) {
                    // ë¨¸ë¦¬ì— ë§ìŒ
                    jegi.vy = -7; // ì†ë„ ê°ì†Œë¡œ ëŠë ¤ì§
                    jegi.vx += (Math.random() - 0.5) * 4;
                    jegi.glow = 5; // ì œê¸° ë°˜ì§ì„ íš¨ê³¼
                    playSound(600, 100); // ì†Œë¦¬ ì¬ìƒ
                    score += 1; // ë¨¸ë¦¬ì— ë§ìœ¼ë©´ 1ì 
                }
            }
        }

        // ê²Œì„ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetGame() {
            // ìµœê³  ì ìˆ˜ ê°±ì‹ 
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('highScore', highScore);
                checkForUnlockedColors();
            }
            // ë³€ìˆ˜ ì´ˆê¸°í™”
            score = 0;
            canKick = true;
            isGameOver = false;
            jegi.x = canvas.width / 2 - jegi.width / 2;
            jegi.y = canvas.height - jegi.height;
            jegi.vx = 0;
            jegi.vy = 0;
            jegi.inAir = false;
            player.x = canvas.width / 2 - player.width / 2; // í”Œë ˆì´ì–´ë¥¼ ì¤‘ì•™ì— ìœ„ì¹˜
            player.movingLeft = false;
            player.movingRight = false;
            // ì„ íƒëœ ìƒ‰ìƒì˜ ì¤‘ë ¥ìœ¼ë¡œ ì¬ì„¤ì •
            jegi.gravity = colors.find(color => color.color === selectedColor).gravity;
        }

        // ê²Œì„ ë£¨í”„
        function gameLoop(time) {
            if (time - lastTime >= gameSpeed) {
                lastTime = time;

                // í™”ë©´ ì§€ìš°ê¸°
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (!isGameOver) {
                    // í”Œë ˆì´ì–´ ì´ë™
                    if (player.movingLeft && player.x > 0) player.x -= player.speed;
                    if (player.movingRight && player.x + player.width < canvas.width) player.x += player.speed;

                    // ì œê¸° ë¬¼ë¦¬ ì²˜ë¦¬
                    if (jegi.inAir) {
                        jegi.vy += jegi.gravity;
                        jegi.x += jegi.vx;
                        jegi.y += jegi.vy;

                        // ë°”ë‹¥ì— ë‹¿ìœ¼ë©´ ê²Œì„ ì˜¤ë²„
                        if (jegi.y + jegi.height >= canvas.height) {
                            jegi.y = canvas.height - jegi.height;
                            jegi.vx = 0;
                            jegi.vy = 0;
                            isGameOver = true;
                            playSound(200, 300); // ë•…ì— ë–¨ì–´ì§€ëŠ” ì†Œë¦¬ ì¬ìƒ

                            // ìµœê³  ì ìˆ˜ ê°±ì‹ 
                            if (score > highScore) {
                                highScore = score;
                                localStorage.setItem('highScore', highScore);
                                checkForUnlockedColors();
                            }

                            // ì œê¸°ë¥¼ ë‹¤ì‹œ ì°° ìˆ˜ ìˆë„ë¡ ì„¤ì •
                            canKick = true;

                            // 1ì´ˆ í›„ ê²Œì„ ì¬ì‹œì‘
                            setTimeout(resetGame, 1000);
                        }

                        // ì œê¸°ê°€ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì œí•œ
                        if (jegi.x <= 0 || jegi.x + jegi.width >= canvas.width) {
                            jegi.vx *= -1;
                        }
                    }

                    // ì œê¸° ë°˜ì§ì„ íš¨ê³¼ ê°ì†Œ
                    if (jegi.glow > 0) {
                        jegi.glow--;
                    }

                    // í”Œë ˆì´ì–´ ê°€ìŠ´ ë¹›ë‚˜ê¸° íš¨ê³¼ ê°ì†Œ
                    if (player.chestGlow > 0) {
                        player.chestGlow--;
                    }
                }

                // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸° (ë¨¸ë¦¬, ê°€ìŠ´, ë‹¤ë¦¬)
                // ë¨¸ë¦¬
                ctx.fillStyle = '#FFD700'; // ê¸ˆìƒ‰
                ctx.fillRect(player.x + player.width / 4, player.y, player.width / 2, player.height / 4);

                // ê°€ìŠ´ (ë‘ ì¹¸ìœ¼ë¡œ ëŠ˜ë¦¼)
                if (player.chestGlow > 0) {
                    ctx.fillStyle = 'rgba(255, 165, 0, 0.8)'; // ì£¼í™©ìƒ‰ ë¹›ë‚¨
                } else {
                    ctx.fillStyle = '#FF8C00'; // ì–´ë‘ìš´ ì£¼í™©ìƒ‰
                }
                ctx.fillRect(player.x, player.y + player.height / 4, player.width, player.height / 2);

                // ë‹¤ë¦¬ (í•œ ì¹¸ìœ¼ë¡œ ì¤„ì„)
                ctx.fillStyle = '#8B4513'; // ê°ˆìƒ‰
                ctx.fillRect(player.x, player.y + (player.height / 4) * 3, player.width, player.height / 4);

                // ì œê¸° ê·¸ë¦¬ê¸°
                if (jegi.glow > 0) {
                    ctx.fillStyle = selectedColor;
                } else {
                    ctx.fillStyle = selectedColor;
                }
                ctx.fillRect(jegi.x, jegi.y, jegi.width, jegi.height);

                // ì ìˆ˜ í‘œì‹œ
                ctx.fillStyle = 'black';
                ctx.font = '20px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('ì ìˆ˜: ' + score, 10, 30);

                // ìµœê³  ì ìˆ˜ í‘œì‹œ (ì˜¤ë¥¸ìª½ ìƒë‹¨ ë)
                ctx.textAlign = 'right';
                ctx.fillText('ìµœê³  ì ìˆ˜: ' + highScore, canvas.width - 10, 30);

                // ê²Œì„ ì˜¤ë²„ ë©”ì‹œì§€
                if (isGameOver) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    ctx.fillStyle = 'white';
                    ctx.font = '40px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ê²Œì„ ì˜¤ë²„', canvas.width / 2, canvas.height / 2);
                }
            }
            requestAnimationFrame(gameLoop);
        }

        gameLoop(0);
    </script>
</body>
</html>
